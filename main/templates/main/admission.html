{% extends 'main/base.html' %}
{% block title %}Admission {% if session %}{{ session.session_name }}{% endif %} ‚Äì DSST{% endblock %}
{% block og_title %}Admissions ‚Äì DSST{% endblock %}
{% block og_description %}Apply for admission at DSST, Aizawl. Quality CBSE education for a brighter future.{% endblock %}

{% block extra_css %}
<style>
    .step-indicator { display:flex; align-items:center; justify-content:center; gap:0; margin-bottom:40px; flex-wrap:wrap; gap:8px; }
    .step { display:flex; align-items:center; gap:8px; }
    .step-num { width:34px; height:34px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:0.85rem; border:2px solid #ddd; color:#aaa; background:white; flex-shrink:0; transition:all 0.3s; }
    .step-num.active { background:var(--primary); border-color:var(--primary); color:white; }
    .step-num.done { background:#28a745; border-color:#28a745; color:white; }
    .step-label { font-size:0.8rem; color:#aaa; font-weight:500; }
    .step-label.active { color:var(--primary); font-weight:700; }
    .step-divider { width:40px; height:2px; background:#ddd; flex-shrink:0; }
    .form-section { display:none; }
    .form-section.active { display:block; }
    .form-label { font-weight:600; font-size:0.85rem; color:#444; }
    .form-control, .form-select { border-radius:10px; border:2px solid #e8e8e8; padding:10px 14px; font-size:0.9rem; transition:border-color 0.2s; }
    .form-control:focus, .form-select:focus { border-color:var(--primary); box-shadow:0 0 0 3px rgba(26,58,110,0.08); }
    .info-banner { background:linear-gradient(135deg,#e8f4fd,#d0e8ff); border-radius:14px; padding:20px; border-left:4px solid var(--primary); }
    .fee-badge { display:inline-block; background:var(--primary); color:white; border-radius:20px; padding:3px 14px; font-size:0.78rem; font-weight:600; }
    @media(max-width:576px) { .step-divider { width:20px; } .step-label { display:none; } }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <nav aria-label="breadcrumb"><ol class="breadcrumb mb-2" style="--bs-breadcrumb-divider-color:rgba(255,255,255,0.5);"><li class="breadcrumb-item"><a href="/" style="color:rgba(255,255,255,0.7);">Home</a></li><li class="breadcrumb-item active text-white">Admission {% if session %}{{ session.session_name }}{% endif %}</li></ol></nav>
        <h1 style="font-family:'Playfair Display',serif;" class="mb-1">üéì Admission Portal {% if session %}{{ session.session_name }}{% endif %}</h1>
        <p style="color:rgba(255,255,255,0.8);">Apply online for Class XI Science. Choose your subject combination below.</p>
        {% if admission_open %}
        <div class="d-flex gap-3 flex-wrap mt-3">
            {% if session.forms_open_date %}<span style="background:rgba(255,255,255,0.15);border-radius:20px;padding:5px 16px;font-size:0.82rem;"><i class="fas fa-calendar me-1"></i>Forms open: {{ session.forms_open_date|date:"M d" }} ‚Äì {{ session.forms_close_date|date:"M d, Y" }}</span>{% endif %}
            {% if session.admission_test_date %}<span style="background:rgba(255,255,255,0.15);border-radius:20px;padding:5px 16px;font-size:0.82rem;"><i class="fas fa-file-alt me-1"></i>Admission Test: {{ session.admission_test_date }}</span>{% endif %}
            {% if session.result_date %}<span style="background:rgba(255,255,255,0.15);border-radius:20px;padding:5px 16px;font-size:0.82rem;"><i class="fas fa-check-circle me-1"></i>Results: {{ session.result_date|date:"M d, Y" }}</span>{% endif %}
        </div>
        {% else %}
        <div class="d-flex gap-3 flex-wrap mt-3">
            <span style="background:rgba(220,53,69,0.3);border:1px solid rgba(220,53,69,0.5);border-radius:20px;padding:5px 16px;font-size:0.82rem;"><i class="fas fa-times-circle me-1"></i>Admissions Currently Closed</span>
        </div>
        {% endif %}
    </div>
</div>

{% if admission_open %}
<!-- ADMISSION FORM -->
<section class="section-py bg-light-custom">
    <div class="container">
        <div class="row g-4">

            <!-- LEFT: FORM -->
            <div class="col-lg-8">
                <div class="card p-4 p-md-5">
                    <div class="step-indicator">
                        <div class="step"><div class="step-num active" id="step-num-1">1</div><div class="step-label active" id="step-lbl-1">Student Info</div></div>
                        <div class="step-divider"></div>
                        <div class="step"><div class="step-num" id="step-num-2">2</div><div class="step-label" id="step-lbl-2">Parent Info</div></div>
                        <div class="step-divider"></div>
                        <div class="step"><div class="step-num" id="step-num-3">3</div><div class="step-label" id="step-lbl-3">Contact</div></div>
                        <div class="step-divider"></div>
                        <div class="step"><div class="step-num" id="step-num-4">4</div><div class="step-label" id="step-lbl-4">Review</div></div>
                    </div>

                    <form method="post" id="admissionForm">
                        {% csrf_token %}

                        <!-- STEP 1: Student Info -->
                        <div class="form-section active" id="section-1">
                            <h5 class="fw-700 mb-4" style="color:var(--primary);"><i class="fas fa-user-graduate me-2"></i>Student Information</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Student Full Name <span class="text-danger">*</span></label>
                                    <input type="text" name="student_name" class="form-control" placeholder="As per birth certificate" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Date of Birth <span class="text-danger">*</span></label>
                                    <input type="date" name="dob" class="form-control" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Gender <span class="text-danger">*</span></label>
                                    <select name="gender" class="form-select" required>
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Blood Group</label>
                                    <select name="blood_group" class="form-select">
                                        <option value="">Select (Optional)</option>
                                        <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                                        <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Applying for Class <span class="text-danger">*</span></label>
                                    <select name="applying_for_class" class="form-select mb-3" id="comboSelect" required>
                                        <option value="">Select Class & Subject Combination</option>
                                        {% regroup classes by class_name as class_groups %}
                                        {% for group in class_groups %}
                                        <optgroup label="{{ group.grouper }}">
                                            {% for cls in group.list %}
                                            <option value="{{ cls.value }}">{{ group.grouper }} ‚Äî {{ cls.combination }} ({{ cls.combination_full }})</option>
                                            {% endfor %}
                                        </optgroup>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Previous School</label>
                                    <input type="text" name="previous_school" class="form-control" placeholder="Name of previous school">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Previous Class Passed</label>
                                    <select name="previous_class" class="form-select">
                                        <option value="">Select Board</option>
                                        <option>CBSE</option>
                                        <option>MBSE (Mizoram Board)</option>
                                        <option>ICSE</option>
                                        <option>Other State Board</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Marks/Percentage</label>
                                    <input type="text" name="previous_percentage" class="form-control" placeholder="e.g. 85%">
                                </div>
                            </div>
                            <div class="d-flex justify-content-end mt-4">
                                <button type="button" class="btn btn-primary rounded-pill px-4" onclick="nextStep(2)">Next: Parent Info <i class="fas fa-arrow-right ms-1"></i></button>
                            </div>
                        </div>

                        <!-- STEP 2: Parent Info -->
                        <div class="form-section" id="section-2">
                            <h5 class="fw-700 mb-4" style="color:var(--primary);"><i class="fas fa-users me-2"></i>Parent / Guardian Information</h5>
                            <div class="row g-3">
                                <div class="col-12"><div style="background:#e8f4fd;border-radius:10px;padding:12px 16px;font-size:0.85rem;color:#1a3a6e;"><i class="fas fa-info-circle me-1"></i>Please provide accurate information. This will be used for all official communications.</div></div>
                                <div class="col-md-6">
                                    <label class="form-label">Father's Full Name <span class="text-danger">*</span></label>
                                    <input type="text" name="father_name" class="form-control" placeholder="Father's name" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Father's Occupation</label>
                                    <input type="text" name="father_occupation" class="form-control" placeholder="e.g. Engineer, Teacher">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Father's Phone <span class="text-danger">*</span></label>
                                    <input type="tel" name="father_phone" class="form-control" placeholder="+91 XXXXX XXXXX" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Mother's Full Name <span class="text-danger">*</span></label>
                                    <input type="text" name="mother_name" class="form-control" placeholder="Mother's name" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Mother's Occupation</label>
                                    <input type="text" name="mother_occupation" class="form-control" placeholder="e.g. Doctor, Homemaker">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Mother's Phone</label>
                                    <input type="tel" name="mother_phone" class="form-control" placeholder="+91 XXXXX XXXXX">
                                </div>
                            </div>
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-outline-secondary rounded-pill px-4" onclick="nextStep(1)"><i class="fas fa-arrow-left me-1"></i> Back</button>
                                <button type="button" class="btn btn-primary rounded-pill px-4" onclick="nextStep(3)">Next: Contact <i class="fas fa-arrow-right ms-1"></i></button>
                            </div>
                        </div>

                        <!-- STEP 3: Contact -->
                        <div class="form-section" id="section-3">
                            <h5 class="fw-700 mb-4" style="color:var(--primary);"><i class="fas fa-map-marker-alt me-2"></i>Contact & Address</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Email Address <span class="text-danger">*</span></label>
                                    <input type="email" name="email" class="form-control" placeholder="your@email.com" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">City <span class="text-danger">*</span></label>
                                    <input type="text" name="city" class="form-control" placeholder="City name" required>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Full Address <span class="text-danger">*</span></label>
                                    <textarea name="address" class="form-control" rows="3" placeholder="House no., Street, Area..." required></textarea>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">PIN Code <span class="text-danger">*</span></label>
                                    <input type="text" name="pincode" class="form-control" placeholder="110001" maxlength="6" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">How did you hear about us?</label>
                                    <select name="how_did_you_hear" class="form-select">
                                        <option value="">Select</option>
                                        <option>Friend / Family</option>
                                        <option>Social Media</option>
                                        <option>Google Search</option>
                                        <option>Newspaper</option>
                                        <option>Hoarding / Banner</option>
                                        <option>School Event</option>
                                        <option>Other</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Additional Remarks</label>
                                    <textarea name="remarks" class="form-control" rows="2" placeholder="Any special requirements or information..."></textarea>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-outline-secondary rounded-pill px-4" onclick="nextStep(2)"><i class="fas fa-arrow-left me-1"></i> Back</button>
                                <button type="button" class="btn btn-primary rounded-pill px-4" onclick="nextStep(4)">Review Application <i class="fas fa-arrow-right ms-1"></i></button>
                            </div>
                        </div>

                        <!-- STEP 4: Review & Submit -->
                        <div class="form-section" id="section-4">
                            <h5 class="fw-700 mb-4" style="color:var(--primary);"><i class="fas fa-clipboard-check me-2"></i>Review & Submit</h5>
                            <div id="reviewContent" style="background:#f8f9fc;border-radius:14px;padding:24px;margin-bottom:20px;">
                                <div class="text-center text-muted py-3"><i class="fas fa-spinner fa-spin me-2"></i>Loading review...</div>
                            </div>
                            <div style="background:#fff3cd;border-radius:12px;padding:16px;margin-bottom:20px;border-left:4px solid #ffc107;">
                                <div style="font-weight:600;margin-bottom:6px;"><i class="fas fa-exclamation-triangle me-1 text-warning"></i>Declaration</div>
                                <div style="font-size:0.85rem;color:#555;">I hereby declare that all information provided is true and correct to the best of my knowledge. I agree to abide by the school's rules and regulations.</div>
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="declareCheck" required>
                                    <label class="form-check-label" for="declareCheck" style="font-size:0.85rem;font-weight:600;">I agree to the above declaration</label>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary rounded-pill px-4" onclick="nextStep(3)"><i class="fas fa-arrow-left me-1"></i> Back</button>
                                <button type="submit" class="btn btn-success btn-lg rounded-pill px-5 fw-bold"><i class="fas fa-paper-plane me-2"></i>Submit Application</button>
                            </div>
                        </div>

                    </form>
                </div>
            </div>

            <!-- RIGHT: INFO SIDEBAR -->
            <div class="col-lg-4">
                <!-- Important Dates -->
                <div class="card p-4 mb-4" style="border-top:4px solid var(--secondary);">
                    <h6 class="fw-700 mb-3" style="color:var(--primary);"><i class="fas fa-calendar-alt me-2 text-warning"></i>Important Dates</h6>
                    {% if session.forms_open_date %}
                    <div class="d-flex gap-3 mb-3 align-items-start">
                        <div style="width:42px;height:42px;border-radius:10px;background:#e8f4fd;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:var(--primary);font-weight:700;font-size:0.8rem;text-align:center;line-height:1.2;">{{ session.forms_open_date|date:"M" }}<br>{{ session.forms_open_date|date:"d" }}</div>
                        <div><div style="font-weight:600;font-size:0.88rem;">Forms Open</div><div style="font-size:0.78rem;color:#888;">{{ session.forms_open_date|date:"d F Y" }}</div></div>
                    </div>
                    {% endif %}
                    {% if session.forms_close_date %}
                    <div class="d-flex gap-3 mb-3 align-items-start">
                        <div style="width:42px;height:42px;border-radius:10px;background:#fff3e0;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:#e65100;font-weight:700;font-size:0.8rem;text-align:center;line-height:1.2;">{{ session.forms_close_date|date:"M" }}<br>{{ session.forms_close_date|date:"d" }}</div>
                        <div><div style="font-weight:600;font-size:0.88rem;">Last Date for Forms</div><div style="font-size:0.78rem;color:#888;">{{ session.forms_close_date|date:"d F Y" }}</div></div>
                    </div>
                    {% endif %}
                    {% if session.admission_test_date %}
                    <div class="d-flex gap-3 mb-3 align-items-start">
                        <div style="width:42px;height:42px;border-radius:10px;background:#ffebee;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:#c62828;font-weight:700;font-size:0.8rem;text-align:center;line-height:1.2;">TEST</div>
                        <div><div style="font-weight:600;font-size:0.88rem;">Admission Test</div><div style="font-size:0.78rem;color:#888;">{{ session.admission_test_date }}</div></div>
                    </div>
                    {% endif %}
                    {% if session.result_date %}
                    <div class="d-flex gap-3 align-items-start">
                        <div style="width:42px;height:42px;border-radius:10px;background:#e8f5e9;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:#2e7d32;font-weight:700;font-size:0.8rem;text-align:center;line-height:1.2;">{{ session.result_date|date:"M" }}<br>{{ session.result_date|date:"d" }}</div>
                        <div><div style="font-weight:600;font-size:0.88rem;">Result Announcement</div><div style="font-size:0.78rem;color:#888;">{{ session.result_date|date:"d F Y" }}</div></div>
                    </div>
                    {% endif %}
                </div>

                <!-- Fee Structure -->
                <div class="card p-4 mb-4">
                    <h6 class="fw-700 mb-3" style="color:var(--primary);"><i class="fas fa-rupee-sign me-2 text-success"></i>Fee Structure</h6>
                    <div class="d-flex justify-content-between py-2 border-bottom" style="font-size:0.85rem;"><span>Monthly Fee</span><strong>&#8377; {{ session.monthly_fee }}/mo</strong></div>
                    <div class="d-flex justify-content-between py-2 border-bottom" style="font-size:0.85rem;"><span>Registration Fee</span><strong>&#8377; {{ session.registration_fee }}</strong></div>
                    <div class="d-flex justify-content-between py-2" style="font-size:0.85rem;"><span>Admission Fee (on selection)</span><strong>&#8377; {{ session.admission_fee }}</strong></div>
                    <div style="background:#e8f5e9;border-radius:8px;padding:10px;margin-top:12px;font-size:0.8rem;color:#2e7d32;"><i class="fas fa-info-circle me-1"></i>Registration fee is non-refundable.</div>
                </div>

                <!-- Documents Required -->
                <div class="card p-4 mb-4">
                    <h6 class="fw-700 mb-3" style="color:var(--primary);"><i class="fas fa-folder-open me-2 text-info"></i>Documents Required</h6>
                    <ul style="padding-left:18px;font-size:0.85rem;color:#555;line-height:2;">
                        {% if documents %}
                            {% for doc in documents %}
                            <li>{{ doc.document_name }}{% if not doc.is_required %} <span style="color:#aaa;font-size:0.75rem;">(optional)</span>{% endif %}</li>
                            {% endfor %}
                        {% else %}
                            <li>Birth Certificate</li>
                            <li>Aadhaar Card (Student & Parents)</li>
                            <li>Previous School Transfer Certificate</li>
                            <li>Last Year's Report Card / Marksheet</li>
                            <li>Passport Size Photos (4 nos.)</li>
                            <li>Caste Certificate (if applicable)</li>
                            <li>Medical Certificate</li>
                        {% endif %}
                    </ul>
                    <div style="background:#fff3e0;border-radius:8px;padding:10px;font-size:0.8rem;color:#e65100;"><i class="fas fa-exclamation-circle me-1"></i>Bring originals + 2 photocopies at the time of admission test.</div>
                </div>

                <!-- Contact -->
                <div class="card p-4" style="background:linear-gradient(135deg,var(--primary),#1565c0);color:white;">
                    <h6 class="fw-700 mb-3"><i class="fas fa-headset me-2"></i>Need Help?</h6>
                    <p style="font-size:0.85rem;color:rgba(255,255,255,0.85);">Our admission team is available Mon‚ÄìSat, 9 AM ‚Äì 4 PM.</p>
                    <a href="tel:+919362603236" class="btn btn-warning btn-sm rounded-pill w-100 mb-2 fw-bold"><i class="fas fa-phone me-1"></i>+91 93626 03236</a>
                    <a href="mailto:admissions@dsstschool.edu" class="btn btn-outline-light btn-sm rounded-pill w-100" style="font-size:0.8rem;"><i class="fas fa-envelope me-1"></i>admissions@dsstschool.edu</a>
                </div>
            </div>

        </div>
    </div>
</section>

{% else %}
<!-- ADMISSIONS CLOSED -->
<section class="section-py bg-light-custom">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-7 col-md-9">
                <div class="card text-center p-5" style="border-radius:24px;">
                    <div style="font-size:5rem;margin-bottom:16px;">üéì</div>
                    <h2 style="font-family:'Playfair Display',serif;color:var(--primary);margin-bottom:12px;">Admissions Closed</h2>
                    <p style="color:#666;font-size:1rem;line-height:1.8;max-width:480px;margin:0 auto 24px;">
                        {% if session %}{{ session.closed_message }}{% else %}Admissions for this session are now closed. Please check back later.{% endif %}
                    </p>
                    {% if session and session.next_open_date %}
                    <div style="background:#e8f4fd;border-radius:14px;padding:18px;margin-bottom:24px;display:inline-block;">
                        <i class="fas fa-calendar-alt me-2 text-primary"></i>
                        <strong>Next admissions open from:</strong>
                        <span style="color:var(--primary);font-weight:700;margin-left:6px;">{{ session.next_open_date|date:"d F Y" }}</span>
                    </div>
                    {% endif %}
                    <div class="row g-3 mb-4 text-start">
                        <div class="col-md-4">
                            <div style="background:#f8f9fc;border-radius:14px;padding:18px;height:100%;">
                                <div style="font-size:1.8rem;margin-bottom:8px;">üìã</div>
                                <div style="font-weight:700;font-size:0.88rem;color:var(--primary);margin-bottom:4px;">Stay Updated</div>
                                <div style="font-size:0.8rem;color:#888;">Check our notice board for latest announcements about upcoming admissions.</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div style="background:#f8f9fc;border-radius:14px;padding:18px;height:100%;">
                                <div style="font-size:1.8rem;margin-bottom:8px;">üìû</div>
                                <div style="font-weight:700;font-size:0.88rem;color:var(--primary);margin-bottom:4px;">Contact Us</div>
                                <div style="font-size:0.8rem;color:#888;">Call us at +91 93626 03236 for enquiries about the next session.</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div style="background:#f8f9fc;border-radius:14px;padding:18px;height:100%;">
                                <div style="font-size:1.8rem;margin-bottom:8px;">üè´</div>
                                <div style="font-weight:700;font-size:0.88rem;color:var(--primary);margin-bottom:4px;">Visit Campus</div>
                                <div style="font-size:0.8rem;color:#888;">Mon‚ÄìSat, 9 AM ‚Äì 4 PM. Come visit us at Dawrpui, Aizawl.</div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex gap-3 justify-content-center flex-wrap">
                        <a href="/notices/" class="btn btn-primary rounded-pill px-4"><i class="fas fa-bell me-2"></i>View Notices</a>
                        <a href="/contact/" class="btn btn-outline-primary rounded-pill px-4"><i class="fas fa-envelope me-2"></i>Contact Us</a>
                        <a href="/" class="btn btn-outline-secondary rounded-pill px-4"><i class="fas fa-home me-2"></i>Go Home</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_js %}
{% if admission_open %}
<script>
let currentStep = 1;

function nextStep(step) {
    if (step > currentStep) {
        const section = document.getElementById('section-' + currentStep);
        const required = section.querySelectorAll('[required]');
        let valid = true;
        required.forEach(field => {
            if (!field.value.trim()) {
                field.style.borderColor = '#dc3545';
                field.focus();
                valid = false;
            } else {
                field.style.borderColor = '#e8e8e8';
            }
        });
        if (!valid) return;
    }

    document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
    document.getElementById('section-' + step).classList.add('active');

    for (let i = 1; i <= 4; i++) {
        const num = document.getElementById('step-num-' + i);
        const lbl = document.getElementById('step-lbl-' + i);
        num.classList.remove('active', 'done');
        lbl.classList.remove('active');
        if (i < step) { num.classList.add('done'); num.innerHTML = '‚úì'; }
        else if (i === step) { num.classList.add('active'); num.innerHTML = i; lbl.classList.add('active'); }
        else { num.innerHTML = i; }
    }

    currentStep = step;
    if (step === 4) buildReview();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function buildReview() {
    const f = document.getElementById('admissionForm');
    const get = name => f.querySelector(`[name="${name}"]`)?.value || '‚Äî';
    const html = `
        <h6 style="color:var(--primary);font-weight:700;margin-bottom:12px;">Student Details</h6>
        <div class="row g-2 mb-3" style="font-size:0.85rem;">
            <div class="col-6"><span style="color:#aaa;">Name</span><div style="font-weight:600;">${get('student_name')}</div></div>
            <div class="col-6"><span style="color:#aaa;">Date of Birth</span><div style="font-weight:600;">${get('dob')}</div></div>
            <div class="col-6"><span style="color:#aaa;">Gender</span><div style="font-weight:600;">${get('gender')}</div></div>
            <div class="col-6"><span style="color:#aaa;">Applying for</span><div style="font-weight:600;">${get('applying_for_class')}</div></div>
            <div class="col-6"><span style="color:#aaa;">Blood Group</span><div style="font-weight:600;">${get('blood_group') || '‚Äî'}</div></div>
            <div class="col-6"><span style="color:#aaa;">Previous School</span><div style="font-weight:600;">${get('previous_school') || '‚Äî'}</div></div>
        </div>
        <hr>
        <h6 style="color:var(--primary);font-weight:700;margin-bottom:12px;">Parent Details</h6>
        <div class="row g-2 mb-3" style="font-size:0.85rem;">
            <div class="col-6"><span style="color:#aaa;">Father's Name</span><div style="font-weight:600;">${get('father_name')}</div></div>
            <div class="col-6"><span style="color:#aaa;">Father's Phone</span><div style="font-weight:600;">${get('father_phone')}</div></div>
            <div class="col-6"><span style="color:#aaa;">Mother's Name</span><div style="font-weight:600;">${get('mother_name')}</div></div>
            <div class="col-6"><span style="color:#aaa;">Mother's Phone</span><div style="font-weight:600;">${get('mother_phone') || '‚Äî'}</div></div>
        </div>
        <hr>
        <h6 style="color:var(--primary);font-weight:700;margin-bottom:12px;">Contact Details</h6>
        <div class="row g-2" style="font-size:0.85rem;">
            <div class="col-6"><span style="color:#aaa;">Email</span><div style="font-weight:600;">${get('email')}</div></div>
            <div class="col-6"><span style="color:#aaa;">City</span><div style="font-weight:600;">${get('city')}</div></div>
            <div class="col-12"><span style="color:#aaa;">Address</span><div style="font-weight:600;">${get('address')}, ${get('pincode')}</div></div>
        </div>
    `;
    document.getElementById('reviewContent').innerHTML = html;
}
</script>
{% endif %}
{% endblock %}